(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),e.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e){var n=e.target;n.classList.contains("popup")&&t(n)}var r="https://nomoreparties.co/v1/wff-cohort-4",c="2f58622b-d0b5-4307-a605-706103b16a1d",a=function(e,t){return fetch("".concat(r,"/cards/likes/").concat(e),{method:t,headers:{authorization:"".concat(c)}}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){return e})).catch((function(e){console.log(e)}))},u=document.querySelector("#card-template").content;function i(e,t,n,o,r){var c,a,i=u.querySelector(".card").cloneNode(!0),l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__count-like"),p=i.querySelector(".card__image"),f=e.name,m=e.link,_=e._id,h=e.likes;return i.querySelector(".card__title").textContent=e.name,i.querySelector(".card__image").src=e.link,i.querySelector(".card__image").alt=e.name,c=r,a=h.map((function(e){return e._id})),a.includes(c)&&s.classList.add("card__like-button_is-active"),e.owner._id!==r&&l.classList.add("hidden_button"),d.textContent=h.length,l.addEventListener("click",(function(e){return t(i,_)})),s.addEventListener("click",(function(e){return n(s,_)})),p.addEventListener("click",(function(e){return o({name:f,link:m})})),i}function l(e,t){var n;n=t,fetch("".concat(r,"/cards/").concat(n),{method:"DELETE",headers:{authorization:"".concat(c)}}).then((function(e){return e.ok?(console.log("DELETE"),e.json()):Promise.reject("Error: ".concat(e.status))})).then((function(e){return console.log(e)})).catch((function(e){console.log(e)})),e.remove()}function s(e,t){var n=e.parentElement.querySelector(".card__count-like");e.classList.contains("card__like-button_is-active")?a(t,"DELETE").then((function(e){var t=e.likes;n.textContent=t.length})):a(t,"PUT").then((function(e){var t=e.likes;n.textContent=t.length})),e.classList.toggle("card__like-button_is-active")}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var p=document.querySelector(".profile__image"),f=document.querySelector(".popup_change-avatar"),m=f.querySelector(".popup__form").elements,_=f.querySelector(".popup__form"),h=f.querySelector(".popup__close"),v=f.querySelector(".popup__button"),y=document.querySelector(".places__list"),k=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),g=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_edit"),q=b.querySelector(".popup__form"),L=q.elements,C=b.querySelector(".popup__close"),j=b.querySelector(".popup__button"),x=document.querySelector(".popup_type_new-card"),P=x.querySelector(".popup__form"),T=x.querySelector(".popup__close"),w=x.querySelector(".popup__button"),A=document.querySelector(".popup_type_image"),O=A.querySelector(".popup__close"),z=A.querySelector(".popup__image"),D=A.querySelector(".popup__caption");function I(){e(f)}function N(){L.name.value=k.textContent,L.description.value=S.textContent,e(b)}function J(e){var n;e.preventDefault(),v.textContent="Сохранение...",M(m.url.value),(n=m.url.value,fetch("".concat(r,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(c),"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){return console.log(e),!0})).catch((function(e){console.log(e)}))).then((function(e){e&&(v.textContent="Сохранить",t(f),m.url.value="")}))}function H(e){var n,o;e.preventDefault(),j.textContent="Сохранение...",(n=L.name.value,o=L.description.value,fetch("".concat(r,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(c),"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){return{user:e,flag:!0}})).catch((function(e){console.log(e)}))).then((function(e){e.flag&&(console.log(e.user),k.textContent=e.user.name,S.textContent=e.user.about,t(b),j.textContent="Сохранить")}))}function U(t){z.src=t.link,z.alt=t.name,D.textContent=t.name,e(A)}function M(e){p.style.backgroundImage="url('".concat(e,"')")}Promise.all([fetch("".concat(r,"/users/me"),{headers:{authorization:"".concat(c)}}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){return{_id:e._id,name:e.name,about:e.about,avatar:e.avatar,cohort:e.cohort}})).catch((function(e){console.log(e)})),fetch("".concat(r,"/cards"),{headers:{authorization:"".concat(c)}}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){return e})).catch((function(e){console.log(e)}))]).then((function(n){var a,u,m=(u=2,function(e){if(Array.isArray(e))return e}(a=n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(a,u)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(a,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),v=m[0],L=m[1],j=v._id;!function(e){M(e.avatar),k.textContent=e.name,S.textContent=e.about}(v),function(e,t){e.forEach((function(e){var n=i(e,l,s,U,t);y.append(n)}))}(L,j),document.querySelectorAll(".popup").forEach((function(e){return e.classList.add("popup_is-animated")})),p.addEventListener("click",I),h.addEventListener("click",(function(){return t(f)})),_.addEventListener("submit",J),f.addEventListener("click",o),g.addEventListener("click",N),q.addEventListener("submit",H),C.addEventListener("click",(function(){return t(b)})),b.addEventListener("click",o),E.addEventListener("click",(function(){return e(x)})),P.addEventListener("submit",(function(e){return function(e,n){console.log(n),e.preventDefault();var o,a=P.elements,u={name:a["place-name"].value,link:a.link.value};w.textContent="Сохранение...",(o=u,fetch("".concat(r,"/cards"),{method:"POST",headers:{authorization:"".concat(c),"Content-Type":"application/json"},body:JSON.stringify({name:o.name,link:o.link})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){var t={card:e,flag:!0};return console.log(e),t})).catch((function(e){console.log(e)}))).then((function(e){if(e.flag){w.textContent="Сохранить";var o=i(e.card,l,s,U,n);y.prepend(o),a["place-name"].value="",a.link.value="",t(x)}}))}(e,j)})),T.addEventListener("click",(function(){return t(x)})),x.addEventListener("click",o),O.addEventListener("click",(function(){return t(A)})),A.addEventListener("click",o)}))})();